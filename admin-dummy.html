<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN PANEL - STAR TRACKER</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .admin-header {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 25px 40px;
            border: 2px solid #18140c;
            margin-bottom: 40px;
        }

        .admin-header h1 {
            font-size: 24px;
            font-weight: 300;
            letter-spacing: 8px;
            text-transform: uppercase;
        }

        .admin-user-info {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 11px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .admin-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="admin-header">
            <h1>ADMIN PANEL</h1>
            <div class="admin-user-info">
                <span id="adminUsername">ADMIN</span>
            </div>
            <div class="admin-actions">
                <button class="btn btn-icon" id="darkModeToggle" title="Toggle Dark Mode">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <button class="btn btn-icon" onclick="logout()" title="Logout">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Stats Section -->
        <div class="stats-section">
            <div class="main-stats" style="border-bottom: none;">
                <div class="stat-box" id="totalUsers">
                    <div class="stat-label">TOTAL USERS</div>
                    <div class="stat-value">142</div>
                </div>
                <div class="stat-box" id="verifiedUsers">
                    <div class="stat-label">VERIFIED</div>
                    <div class="stat-value">98</div>
                </div>
                <div class="stat-box" id="totalKills">
                    <div class="stat-label">TOTAL KILLS</div>
                    <div class="stat-value">3847</div>
                </div>
                <div class="stat-box" id="adminLogins">
                    <div class="stat-label">ADMIN LOGINS</div>
                    <div class="stat-value">27</div>
                </div>
            </div>
        </div>

        <!-- View Buttons (Tabs) -->
        <div class="view-buttons">
            <button class="view-btn active" onclick="switchTab('users')">USERS</button>
            <button class="view-btn" onclick="switchTab('audit')">AUDIT LOGS</button>
            <button class="view-btn" onclick="switchTab('tools')">TOOLS</button>
        </div>

        <!-- Users Tab -->
        <div id="usersTab" style="display: block;">
            <!-- Search and Filter Panel -->
            <div class="filter-panel">
                <div class="filter-row">
                    <div class="search-container">
                        <input type="text" id="userSearch" class="search-input" placeholder="SEARCH USERNAME OR IN-GAME NAME..." oninput="filterUsers()">
                    </div>
                </div>
                <div class="filter-row" style="grid-template-columns: 1fr 1fr 1fr;">
                    <div class="custom-select" id="verificationFilter">
                        <div class="select-display">ALL USERS</div>
                        <div class="select-options">
                            <div class="select-option" data-value="all">ALL USERS</div>
                            <div class="select-option" data-value="verified">VERIFIED ONLY</div>
                            <div class="select-option" data-value="unverified">UNVERIFIED ONLY</div>
                        </div>
                    </div>
                    <div class="custom-select" id="sortFilter">
                        <div class="select-display">SORT OPTIONS</div>
                        <div class="select-options">
                            <div class="select-option" data-value="newest">NEWEST FIRST</div>
                            <div class="select-option" data-value="oldest">OLDEST FIRST</div>
                            <div class="select-option" data-value="kills-high">MOST KILLS</div>
                            <div class="select-option" data-value="kills-low">LEAST KILLS</div>
                            <div class="select-option" data-value="username">USERNAME A-Z</div>
                        </div>
                    </div>
                    <button class="reset-filter-btn" onclick="resetFilters()">RESET FILTERS</button>
                </div>
            </div>

            <div class="content-area" id="usersContent">
            </div>
        </div>

        <!-- Audit Logs Tab -->
        <div id="auditTab" style="display: none;">
            <div class="content-area" id="auditContent">
                <div class="kill-entry">
                    <div class="kill-players">
                        <span class="player-name">AquaRex</span>
                        <span class="meta-item" style="margin-left: 20px;">USER_DELETE</span>
                    </div>
                    <div class="kill-meta">
                        <span class="meta-item">Deleted user ID: 42</span>
                        <span class="kill-time">10/25/2025, 14:32:15</span>
                    </div>
                </div>
                <div class="kill-entry">
                    <div class="kill-players">
                        <span class="player-name">AquaRex</span>
                        <span class="meta-item" style="margin-left: 20px;">KILL_REASSIGN</span>
                    </div>
                    <div class="kill-meta">
                        <span class="meta-item">Reassigned 15 kills from user 5 to user 2</span>
                        <span class="kill-time">10/24/2025, 09:18:42</span>
                    </div>
                </div>
                <div class="kill-entry">
                    <div class="kill-players">
                        <span class="player-name">AquaRex</span>
                        <span class="meta-item" style="margin-left: 20px;">LOGIN</span>
                    </div>
                    <div class="kill-meta">
                        <span class="meta-item">Successful 2FA login</span>
                        <span class="kill-time">10/24/2025, 08:45:22</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tools Tab -->
        <div id="toolsTab" style="display: none;">
            <div class="filter-panel">
                <div class="filter-row">
                    <div id="toolsMessage" style="padding: 25px 40px; font-size: 11px; letter-spacing: 2px; text-transform: uppercase;">KILL REASSIGNMENT</div>
                </div>
                <div class="filter-row" style="grid-template-columns: 1fr 1fr;">
                    <input type="text" id="sourceUserId" class="search-input" placeholder="SOURCE USER ID" style="border-right: 2px solid #18140c;">
                    <input type="text" id="targetUserId" class="search-input" placeholder="TARGET USER ID">
                </div>
                <div class="filter-row" style="grid-template-columns: 1fr;">
                    <button class="view-btn" onclick="reassignKills()" style="width: 100%;">REASSIGN KILLS</button>
                </div>
            </div>
            
            <div class="content-area" style="min-height: 200px; display: grid; grid-template-columns: 1fr 1fr;">
                <button class="view-btn" onclick="clearUserDatabase()" style="background: #d05252; border-color: #d05252; color: #aba9a2; border-radius: 0; border-right: 2px solid #18140c; border-top: none; border-bottom: none; border-left: none;">CLEAR USER DATABASE</button>
                <button class="view-btn" onclick="clearKillsDatabase()" style="background: #d05252; border-color: #d05252; color: #aba9a2; border-radius: 0; border: none;">CLEAR KILLS DATABASE</button>
            </div>
        </div>
    </div>

    <script>
        // Sample user data (25 users)
        const allUsers = [
            { id: 1, username: 'AquaRex', inGameName: 'AquaRex', kills: 247, verified: true, created: '10/15/2025' },
            { id: 2, username: 'SpacePirate', inGameName: 'SpacePirate', kills: 189, verified: true, created: '10/12/2025' },
            { id: 3, username: 'NoobSlayer', inGameName: '', kills: 142, verified: false, created: '10/10/2025' },
            { id: 4, username: 'StarHunter', inGameName: 'StarHunter', kills: 312, verified: true, created: '10/08/2025' },
            { id: 5, username: 'GhostRider', inGameName: 'GhostRider', kills: 98, verified: true, created: '10/05/2025' },
            { id: 6, username: 'CrimsonWolf', inGameName: 'CrimsonWolf', kills: 215, verified: true, created: '10/04/2025' },
            { id: 7, username: 'ShadowStrike', inGameName: '', kills: 67, verified: false, created: '10/03/2025' },
            { id: 8, username: 'NovaBlade', inGameName: 'NovaBlade', kills: 178, verified: true, created: '10/02/2025' },
            { id: 9, username: 'VoidWalker', inGameName: 'VoidWalker', kills: 293, verified: true, created: '10/01/2025' },
            { id: 10, username: 'PhantomAce', inGameName: 'PhantomAce', kills: 156, verified: true, created: '09/30/2025' },
            { id: 11, username: 'ThunderFox', inGameName: '', kills: 89, verified: false, created: '09/29/2025' },
            { id: 12, username: 'IronKnight', inGameName: 'IronKnight', kills: 234, verified: true, created: '09/28/2025' },
            { id: 13, username: 'CosmicReaper', inGameName: 'CosmicReaper', kills: 401, verified: true, created: '09/27/2025' },
            { id: 14, username: 'SolarFlare', inGameName: 'SolarFlare', kills: 167, verified: true, created: '09/26/2025' },
            { id: 15, username: 'DarkMatter', inGameName: '', kills: 45, verified: false, created: '09/25/2025' },
            { id: 16, username: 'NeonHawk', inGameName: 'NeonHawk', kills: 298, verified: true, created: '09/24/2025' },
            { id: 17, username: 'FrostByte', inGameName: 'FrostByte', kills: 187, verified: true, created: '09/23/2025' },
            { id: 18, username: 'VenomStrike', inGameName: '', kills: 123, verified: false, created: '09/22/2025' },
            { id: 19, username: 'BlazeFury', inGameName: 'BlazeFury', kills: 276, verified: true, created: '09/21/2025' },
            { id: 20, username: 'SkyRaider', inGameName: 'SkyRaider', kills: 209, verified: true, created: '09/20/2025' },
            { id: 21, username: 'QuantumShift', inGameName: 'QuantumShift', kills: 154, verified: true, created: '09/19/2025' },
            { id: 22, username: 'StormBreaker', inGameName: '', kills: 78, verified: false, created: '09/18/2025' },
            { id: 23, username: 'EclipseWing', inGameName: 'EclipseWing', kills: 341, verified: true, created: '09/17/2025' },
            { id: 24, username: 'TitanForce', inGameName: 'TitanForce', kills: 265, verified: true, created: '09/16/2025' },
            { id: 25, username: 'VortexRider', inGameName: 'VortexRider', kills: 198, verified: true, created: '09/15/2025' }
        ];

        let currentPage = 1;
        let filteredUsers = [...allUsers];
        let expandedUserId = null;

        function renderUsers() {
            if (filteredUsers.length === 0) {
                document.getElementById('usersContent').innerHTML = '<div class="no-data" style="text-align: center; padding: 40px; font-size: 12px; letter-spacing: 2px; text-transform: uppercase;">NO USERS FOUND</div>';
                return;
            }

            const usersHtml = filteredUsers.map(user => `
                <div class="user-item" id="user-${user.id}" style="border-bottom: 2px solid #18140c;">
                    <div class="kill-entry" onclick="toggleUserDetails(${user.id})" style="cursor: pointer; border-bottom: none;">
                        <div class="kill-players">
                            <span class="player-name" style="font-weight: 500;">${user.username}</span>
                            <span class="meta-item" style="margin-left: 20px;">ID: ${user.id}</span>
                            ${user.verified ? '<span class="meta-item" style="color: #52d075;">✓ VERIFIED</span>' : '<span class="meta-item" style="color: #d05252;">✗ NOT VERIFIED</span>'}
                        </div>
                        <div class="kill-meta">
                            <span class="meta-item">${user.kills} KILLS</span>
                            <span class="meta-item">${user.inGameName || 'NO IN-GAME NAME'}</span>
                            <span class="kill-time">${user.created}</span>
                        </div>
                    </div>
                    <div class="user-details" id="details-${user.id}" style="display: none; border: 2px solid #18140c; margin: 40px;">
                        <div style="padding: 40px; display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                            <div>
                                <div style="font-size: 10px; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 8px; opacity: 0.7;">USER ID</div>
                                <div style="font-size: 14px;">${user.id}</div>
                            </div>
                            <div>
                                <div style="font-size: 10px; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 8px; opacity: 0.7;">USERNAME</div>
                                <div style="font-size: 14px;">${user.username}</div>
                            </div>
                            <div>
                                <div style="font-size: 10px; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 8px; opacity: 0.7;">IN-GAME NAME</div>
                                <div style="font-size: 14px;">${user.inGameName || 'NO IN-GAME NAME'}</div>
                            </div>
                            <div>
                                <div style="font-size: 10px; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 8px; opacity: 0.7;">EMAIL</div>
                                <div style="font-size: 14px;">${user.username.toLowerCase()}@example.com</div>
                            </div>
                            <div>
                                <div style="font-size: 10px; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 8px; opacity: 0.7;">VERIFIED</div>
                                <div style="font-size: 14px;">${user.verified ? 'YES' : 'NO'}</div>
                            </div>
                            <div>
                                <div style="font-size: 10px; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 8px; opacity: 0.7;">TOTAL KILLS</div>
                                <div style="font-size: 14px;">${user.kills}</div>
                            </div>
                            <div>
                                <div style="font-size: 10px; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 8px; opacity: 0.7;">CREATED</div>
                                <div style="font-size: 14px;">${user.created}</div>
                            </div>
                            <div>
                                <div style="font-size: 10px; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 8px; opacity: 0.7;">LAST LOGIN</div>
                                <div style="font-size: 14px;">10/25/2025</div>
                            </div>
                        </div>
                        <div style="padding: 40px; padding-top: 0;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; border: 2px solid #18140c;">
                                <button class="view-btn" style="background: #d05252; border-color: #d05252; color: #aba9a2; border-radius: 0; border-right: 2px solid #18140c; border-top: none; border-bottom: none; border-left: none;" onclick="deleteUser(${user.id})">DELETE USER</button>
                                <button class="view-btn" style="border-radius: 0; border-right: 2px solid #18140c; border-top: none; border-bottom: none; border-left: none;" onclick="resetPassword(${user.id})">RESET PASSWORD</button>
                                <button class="view-btn" style="border-radius: 0; border: none;" onclick="toggleVerification(${user.id})">${user.verified ? 'UNVERIFY' : 'VERIFY'} USER</button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('usersContent').innerHTML = usersHtml;
        }

        function toggleUserDetails(userId) {
            const detailsElement = document.getElementById(`details-${userId}`);
            
            // If clicking the same user, just toggle
            if (expandedUserId === userId) {
                detailsElement.style.display = 'none';
                expandedUserId = null;
            } else {
                // Close previously expanded user
                if (expandedUserId !== null) {
                    const previousDetails = document.getElementById(`details-${expandedUserId}`);
                    if (previousDetails) {
                        previousDetails.style.display = 'none';
                    }
                }
                // Open clicked user
                detailsElement.style.display = 'block';
                expandedUserId = userId;
            }
        }

        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
                alert(`DELETE USER ${userId} - This would call the API`);
            }
        }

        function resetPassword(userId) {
            alert(`RESET PASSWORD for user ${userId} - This would send a password reset email`);
        }

        function toggleVerification(userId) {
            alert(`TOGGLE VERIFICATION for user ${userId} - This would update the verification status`);
        }

        function filterUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const verificationFilterValue = document.querySelector('#verificationFilter .select-display').getAttribute('data-value') || 'all';
            const sortFilter = document.querySelector('#sortFilter .select-display').getAttribute('data-value') || 'newest';

            // Filter by search term
            filteredUsers = allUsers.filter(user => {
                const matchesSearch = searchTerm === '' || 
                    user.username.toLowerCase().includes(searchTerm) || 
                    user.inGameName.toLowerCase().includes(searchTerm);
                
                const matchesVerification = 
                    verificationFilterValue === 'all' ||
                    (verificationFilterValue === 'verified' && user.verified) ||
                    (verificationFilterValue === 'unverified' && !user.verified);

                return matchesSearch && matchesVerification;
            });

            // Sort users
            switch(sortFilter) {
                case 'oldest':
                    filteredUsers.sort((a, b) => new Date(a.created) - new Date(b.created));
                    break;
                case 'kills-high':
                    filteredUsers.sort((a, b) => b.kills - a.kills);
                    break;
                case 'kills-low':
                    filteredUsers.sort((a, b) => a.kills - b.kills);
                    break;
                case 'username':
                    filteredUsers.sort((a, b) => a.username.localeCompare(b.username));
                    break;
                case 'newest':
                default:
                    filteredUsers.sort((a, b) => new Date(b.created) - new Date(a.created));
                    break;
            }

            renderUsers();
        }

        // Custom select functionality
        document.querySelectorAll('.custom-select').forEach(select => {
            const display = select.querySelector('.select-display');
            const options = select.querySelector('.select-options');
            
            display.addEventListener('click', (e) => {
                e.stopPropagation();
                document.querySelectorAll('.custom-select').forEach(s => {
                    if (s !== select) s.classList.remove('open');
                });
                select.classList.toggle('open');
            });

            select.querySelectorAll('.select-option').forEach(option => {
                option.addEventListener('click', (e) => {
                    e.stopPropagation();
                    display.textContent = option.textContent;
                    display.setAttribute('data-value', option.getAttribute('data-value'));
                    select.classList.remove('open');
                    filterUsers();
                });
            });
        });

        document.addEventListener('click', () => {
            document.querySelectorAll('.custom-select').forEach(s => s.classList.remove('open'));
        });

        function resetFilters() {
            document.getElementById('userSearch').value = '';
            document.querySelector('#verificationFilter .select-display').textContent = 'ALL USERS';
            document.querySelector('#verificationFilter .select-display').setAttribute('data-value', 'all');
            document.querySelector('#sortFilter .select-display').textContent = 'SORT OPTIONS';
            document.querySelector('#sortFilter .select-display').removeAttribute('data-value');
            filterUsers();
        }

        function switchTab(tabName) {
            // Hide all tabs
            document.getElementById('usersTab').style.display = 'none';
            document.getElementById('auditTab').style.display = 'none';
            document.getElementById('toolsTab').style.display = 'none';

            // Remove active class from all buttons
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));

            // Show selected tab
            document.getElementById(`${tabName}Tab`).style.display = 'block';

            // Add active class to clicked button
            event.target.classList.add('active');
        }

        function logout() {
            alert('LOGOUT CLICKED');
        }

        function reassignKills() {
            const sourceUserId = document.getElementById('sourceUserId').value;
            const targetUserId = document.getElementById('targetUserId').value;
            const messageBox = document.getElementById('toolsMessage');

            if (!sourceUserId || !targetUserId) {
                messageBox.textContent = 'ERROR: BOTH USER IDS ARE REQUIRED';
                messageBox.style.color = '#d05252';
                return;
            }

            messageBox.textContent = `SUCCESS: 15 KILLS REASSIGNED FROM USER ${sourceUserId} TO USER ${targetUserId}`;
            messageBox.style.color = '#52d075';

            document.getElementById('sourceUserId').value = '';
            document.getElementById('targetUserId').value = '';
            
            // Reset message after 3 seconds
            setTimeout(() => {
                messageBox.textContent = 'KILL REASSIGNMENT';
                messageBox.style.color = '';
            }, 3000);
        }

        function clearUserDatabase() {
            if (confirm('WARNING: This will permanently delete ALL users from the database. This action cannot be undone. Are you absolutely sure?')) {
                if (confirm('FINAL CONFIRMATION: Delete all users?')) {
                    alert('CLEAR USER DATABASE - This would call the API to delete all user records');
                    // API call would go here: DELETE /api/Admin/users/clear
                }
            }
        }

        function clearKillsDatabase() {
            if (confirm('WARNING: This will permanently delete ALL kills from the database. This action cannot be undone. Are you absolutely sure?')) {
                if (confirm('FINAL CONFIRMATION: Delete all kills?')) {
                    alert('CLEAR KILLS DATABASE - This would call the API to delete all kill records');
                    // API call would go here: DELETE /api/Admin/kills/clear
                }
            }
        }

        // Dark mode toggle
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');
        }

        // Initialize dark mode from localStorage
        if (localStorage.getItem('darkMode') === 'enabled') {
            document.body.classList.add('dark-mode');
        }

        // Add dark mode toggle event listener
        document.getElementById('darkModeToggle').addEventListener('click', toggleDarkMode);

        // Initial render
        renderUsers();
    </script>
</body>
</html>
